<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Magic Report (Final)</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
    <style>
        body { padding: 0; margin: 0; background: #F0F2F5; font-family: 'Noto Sans KR', sans-serif; height: 100vh; display: flex; flex-direction: column; }
        
        /* Header */
        .header { background: white; padding: 15px 30px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; }
        .header h2 { color: #6554C0; font-size: 20px; font-weight: 800; display: flex; align-items: center; gap: 10px; margin: 0; }

        /* Layout */
        .content-area { flex: 1; padding: 30px; overflow: hidden; display: flex; gap: 30px; }
        
        /* Left Panel: Settings */
        .input-panel { flex: 1; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; flex-direction: column; overflow-y: auto; }
        
        /* Right Panel: Preview */
        .preview-panel { flex: 1.2; background: #F8F9FB; padding: 25px; border-radius: 12px; border: 1px solid #EAE6FF; display: flex; flex-direction: column; }

        /* Form Elements */
        .section-title { font-size: 15px; font-weight: 800; color: #333; margin-bottom: 15px; border-bottom: 2px solid #f0f0f0; padding-bottom: 8px; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-weight: bold; margin-bottom: 8px; font-size: 13px; color: #555; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; transition: 0.2s; }
        .form-control:focus { border-color: #6554C0; outline: none; }

        /* Task Selector */
        .task-list-box { border: 1px solid #eee; border-radius: 8px; padding: 10px; max-height: 200px; overflow-y: auto; background: #fafafa; }
        .task-item { display: flex; align-items: center; gap: 10px; padding: 8px; border-radius: 6px; background: white; border: 1px solid #eee; margin-bottom: 6px; transition: 0.2s; cursor: pointer; }
        .task-item:hover { border-color: #6554C0; }
        .task-item.selected { background: #F3F0FF; border-color: #6554C0; }
        .task-info { flex: 1; }
        .t-title { font-size: 13px; font-weight: bold; color: #333; }
        .t-meta { font-size: 11px; color: #888; }
        .t-score { font-weight: bold; color: #0052CC; font-size: 12px; }

        /* Options Grid */
        .opt-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        /* Button */
        .btn-magic { width: 100%; background: linear-gradient(135deg, #6554C0, #8777D9); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 15px; margin-top: auto; box-shadow: 0 4px 12px rgba(101, 84, 192, 0.3); transition: 0.2s; }
        .btn-magic:hover { transform: translateY(-2px); }

        /* Report Card (Right Side) */
        .report-card { background: white; border-radius: 16px; padding: 40px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; }
        .report-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px; background: linear-gradient(90deg, #6554C0, #FF0080); }
        
        .r-header { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .r-date { font-size: 12px; color: #888; text-align: right; margin-bottom: 5px; }
        .r-title { font-size: 22px; font-weight: 800; color: #1A1F36; }
        
        .r-body { flex: 1; font-size: 15px; line-height: 1.8; color: #444; white-space: pre-wrap; font-family: 'Noto Sans KR', sans-serif; }
        
        .r-footer { margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; display: flex; align-items: center; gap: 15px; }
        .teacher-badge { width: 45px; height: 45px; background: #eee; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #666; }
        
        /* Action Buttons */
        .action-bar { display: flex; gap: 10px; margin-top: 20px; }
        .btn-action { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px; }
        .btn-copy { background: #E9ECEF; color: #333; }
        .btn-kakao { background: #FAE100; color: #3C1E1E; }

        /* Loader */
        .loader-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 10; border-radius: 16px; }
        .magic-icon { font-size: 40px; color: #6554C0; animation: pulse 1.5s infinite; margin-bottom: 15px; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.7; } 100% { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

<div class="header">
    <h2><i class="fa-solid fa-wand-magic-sparkles"></i> Magic Report</h2>
    <div style="font-size:12px; color:#666;">AI ê¸°ë°˜ ë§ì¶¤í˜• í•™ìŠµ ë¦¬í¬íŠ¸ ìƒì„±ê¸°</div>
</div>

<div class="content-area">
    
    <div class="input-panel">
        <div class="section-title">1. ëŒ€ìƒ ë° ë°ì´í„° ì„ íƒ</div>
        <div class="form-group">
            <label class="form-label">í•™ìƒ ì„ íƒ</label>
            <select class="form-control" id="target-student" onchange="loadStudentData()">
                <option value="">í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
        </div>

        <div class="form-group">
            <label class="form-label">ë¦¬í¬íŠ¸ì— í¬í•¨í•  ìµœê·¼ ì™„ë£Œ ê³¼ì œ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)</label>
            <div class="task-list-box" id="task-list-container">
                <div style="text-align:center; padding:20px; color:#999; font-size:13px;">í•™ìƒì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.</div>
            </div>
        </div>

        <div class="section-title">2. ë¦¬í¬íŠ¸ ì„¤ì •</div>
        <div class="opt-grid">
            <div class="form-group">
                <label class="form-label">ëª©ì  (Purpose)</label>
                <select class="form-control" id="report-purpose">
                    <option value="monthly">ì›”ê°„ í•™ìŠµ ë¦¬í¬íŠ¸ (ì •ê¸°)</option>
                    <option value="praise">ì¹­ì°¬ ë° ê²©ë ¤ (ë™ê¸°ë¶€ì—¬)</option>
                    <option value="counsel">í•™ìŠµ íƒœë„ ìƒë‹´ (ê°œì„ ìš”ì²­)</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">ì–´ì¡° (Tone)</label>
                <select class="form-control" id="report-tone">
                    <option value="polite">ì •ì¤‘í•˜ê³  ì‹ ë¢°ê° ìˆê²Œ (ê¸°ë³¸)</option>
                    <option value="friendly">ì¹œê·¼í•˜ê³  ë‹¤ì •í•˜ê²Œ (ë¶€ë“œëŸ¬ì›€)</option>
                    <option value="factual">ê°ê´€ì ì´ê³  ê°„ê²°í•˜ê²Œ (ë°ì´í„° ì¤‘ì‹¬)</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">ì„ ìƒë‹˜ ê°•ì¡° ì½”ë©˜íŠ¸ (Keywords)</label>
            <input type="text" class="form-control" id="report-keywords" placeholder="ì˜ˆ: ìê¸°ì£¼ë„í•™ìŠµ ëŠ¥ë ¥ í–¥ìƒ, ë‹¨ì–´ ì•”ê¸° í•„ìš”">
        </div>

        <button class="btn-magic" onclick="generateReport()">
            <i class="fa-solid fa-bolt"></i> AI ë¦¬í¬íŠ¸ ìƒì„±í•˜ê¸°
        </button>
    </div>

    <div class="preview-panel">
        <div class="report-card">
            <div class="loader-overlay" id="ai-loader">
                <i class="fa-solid fa-wand-magic-sparkles magic-icon"></i>
                <div style="font-weight:bold; color:#6554C0;">AIê°€ í•™ìŠµ ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>
                <div style="font-size:12px; color:#888;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</div>
            </div>

            <div class="r-header">
                <div class="r-date" id="r-date">2025. 12. 10</div>
                <div class="r-title">Class Report</div>
            </div>
            
            <div class="r-body" id="r-content">
                <span style="color:#aaa;">ì¢Œì¸¡ ë©”ë‰´ì—ì„œ í•™ìƒê³¼ ê³¼ì œë¥¼ ì„ íƒí•˜ê³  [ìƒì„±í•˜ê¸°] ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</span>
            </div>

            <div class="r-footer">
                <div class="teacher-badge"><i class="fa-solid fa-user-tie"></i></div>
                <div>
                    <div style="font-family: 'Nanum Pen Script', cursive; font-size: 20px; font-weight:bold;">Teacher Kim</div>
                    <div style="font-size: 11px; color: #999;">Yoon's English School</div>
                </div>
            </div>
        </div>

        <div class="action-bar">
            <button class="btn-action btn-copy" onclick="copyToClipboard()"><i class="fa-regular fa-copy"></i> í…ìŠ¤íŠ¸ ë³µì‚¬</button>
            <button class="btn-action btn-kakao" onclick="alert('í•™ë¶€ëª¨ë‹˜ê»˜ ì¹´ì¹´ì˜¤í†¡ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.')"><i class="fa-solid fa-comment"></i> ì¹´ì¹´ì˜¤í†¡ ì „ì†¡</button>
        </div>
    </div>

</div>

<script>
    const DB_KEY = 'yoons_v3_2_db';
    
    // 1. Initialize
    window.onload = function() {
        const DB = JSON.parse(localStorage.getItem(DB_KEY)) || { students: [] };
        const select = document.getElementById('target-student');
        
        // Mock data check
        if(DB.students.length === 0) {
            alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. index.htmlì„ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”.");
            return;
        }

        DB.students.forEach(s => {
            const opt = document.createElement('option');
            opt.value = s.name;
            opt.innerText = `${s.name} (${s.grade})`;
            select.appendChild(opt);
        });

        // Set Date
        document.getElementById('r-date').innerText = new Date().toLocaleDateString();
    };

    // 2. Load Tasks Logic
    function loadStudentData() {
        const studentName = document.getElementById('target-student').value;
        const container = document.getElementById('task-list-container');
        container.innerHTML = '';

        if(!studentName) {
            container.innerHTML = '<div style="text-align:center; padding:20px; color:#999; font-size:13px;">í•™ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.</div>';
            return;
        }

        const DB = JSON.parse(localStorage.getItem(DB_KEY));
        // Filter: Last 1 Month (Simplified logic: show all 'done' or 'submitted')
        // In real app, check date diff
        const tasks = DB.assignments.filter(a => 
            a.student === studentName && 
            (a.status === 'done' || a.status === 'submitted')
        );

        if(tasks.length === 0) {
            container.innerHTML = '<div style="text-align:center; padding:20px; color:#999; font-size:13px;">ìµœê·¼ ì™„ë£Œí•œ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        tasks.forEach(t => {
            const div = document.createElement('div');
            div.className = 'task-item';
            div.onclick = function() { this.classList.toggle('selected'); };
            
            let scoreBadge = '';
            if(t.score) scoreBadge = `<span class="t-score">${t.score}ì </span>`;
            else if(t.status === 'done') scoreBadge = `<span class="t-score" style="color:#00875A">ì™„ë£Œ</span>`;
            else scoreBadge = `<span class="t-score" style="color:#FF991F">ì œì¶œë¨</span>`;

            div.innerHTML = `
                <input type="checkbox" style="pointer-events:none;">
                <div class="task-info">
                    <div class="t-title">${t.title}</div>
                    <div class="t-meta">${t.type} | ${t.date}</div>
                </div>
                ${scoreBadge}
            `;
            container.appendChild(div);
        });
    }

    // 3. AI Generation Logic
    function generateReport() {
        const studentName = document.getElementById('target-student').value;
        if(!studentName) return alert("í•™ìƒì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");

        // Get Inputs
        const selectedTasks = [];
        const taskItems = document.querySelectorAll('.task-item');
        taskItems.forEach(item => {
            if(item.classList.contains('selected')) {
                const title = item.querySelector('.t-title').innerText;
                const score = item.querySelector('.t-score').innerText;
                selectedTasks.push({ title, score });
            }
        });

        const purpose = document.getElementById('report-purpose').value;
        const tone = document.getElementById('report-tone').value;
        const keywords = document.getElementById('report-keywords').value;

        // Show Loader
        const loader = document.getElementById('ai-loader');
        loader.style.display = 'flex';

        setTimeout(() => {
            // Logic to build text
            let text = "";
            
            // 1. Greeting
            if(tone === 'polite') text += `${studentName} í•™ìƒ í•™ë¶€ëª¨ë‹˜, ì•ˆë…•í•˜ì‹­ë‹ˆê¹Œ. ìœ¤ì„ ìƒ ì˜ì–´êµì‹¤ì…ë‹ˆë‹¤.\n\n`;
            else if(tone === 'friendly') text += `${studentName} ì–´ë¨¸ë‹ˆ, ì•ˆë…•í•˜ì„¸ìš”! ë‹´ë‹¹êµì‚¬ ê¹€ìœ¤ìˆ˜ì…ë‹ˆë‹¤. ^^ \n\n`;
            else text += `[${studentName} í•™ìƒ í•™ìŠµ ë¦¬í¬íŠ¸]\n\n`;

            // 2. Opening (Purpose)
            if(purpose === 'monthly') text += `ì´ë²ˆ ë‹¬ ${studentName} í•™ìƒì˜ í•™ìŠµ ì„±ì·¨ë„ì™€ ê³¼ì œ ìˆ˜í–‰ ê²°ê³¼ë¥¼ ì •ë¦¬í•˜ì—¬ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤. ê¾¸ì¤€íˆ í•™ìŠµì„ ì´ì–´ë‚˜ê°€ëŠ” ëª¨ìŠµì´ ì¸ìƒì ì…ë‹ˆë‹¤.\n\n`;
            else if(purpose === 'praise') text += `ìš”ì¦˜ ${studentName}ì´ê°€ ìˆ˜ì—… ì‹œê°„ì— ë³´ì—¬ì£¼ëŠ” ì—´ì •ê³¼ ì„±ì‹¤í•¨ì´ ë„ˆë¬´ ê¸°íŠ¹í•´ì„œ ì†Œì‹ ì „í•´ë“œë¦½ë‹ˆë‹¤!\n\n`;
            else text += `ìµœê·¼ í•™ìŠµ ì§„í–‰ ìƒí™©ì— ëŒ€í•´ ëª‡ ê°€ì§€ ìƒì˜ ë“œë¦´ ë§ì”€ì´ ìˆì–´ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n`;

            // 3. Data Analysis (Selected Tasks)
            if(selectedTasks.length > 0) {
                text += "ğŸ“Š [ì£¼ìš” í•™ìŠµ ì„±ê³¼]\n";
                selectedTasks.forEach(t => {
                    text += `- ${t.title}: ${t.score}\n`;
                });
                text += "\nìœ„ì™€ ê°™ì´ ìµœê·¼ ê³¼ì œë¥¼ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰í•˜ì˜€ìŠµë‹ˆë‹¤. ";
                
                if(selectedTasks.some(t => t.score.includes('ì ') && parseInt(t.score) > 90)) {
                    text += "íŠ¹íˆ í‰ê°€ ì ìˆ˜ê°€ ë§¤ìš° ìš°ìˆ˜í•˜ì—¬ ê¸°ì´ˆ ì‹¤ë ¥ì´ íƒ„íƒ„í•´ì§€ê³  ìˆìŒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.\n\n";
                } else {
                    text += "ì„±ì‹¤í•˜ê²Œ ê³¼ì œë¥¼ ì œì¶œí•˜ëŠ” íƒœë„ê°€ ì‹¤ë ¥ í–¥ìƒì˜ ë°‘ê±°ë¦„ì´ ë˜ê³  ìˆìŠµë‹ˆë‹¤.\n\n";
                }
            } else {
                text += "ìµœê·¼ ì™„ë£Œëœ ê³¼ì œ ë‚´ì—­ì€ ì—†ìœ¼ë‚˜, ìˆ˜ì—… ì°¸ì—¬ë„ëŠ” ì–‘í˜¸í•©ë‹ˆë‹¤.\n\n";
            }

            // 4. Teacher's Comment (Keywords)
            if(keywords) {
                text += "ğŸ’¡ [êµì‚¬ ì½”ë©˜íŠ¸]\n";
                text += `ì„ ìƒë‹˜ì´ ì§€ì¼œë³¸ ê²°ê³¼, ${studentName} í•™ìƒì€ ${keywords} ë©´ì—ì„œ ê¸ì •ì ì¸ ë³€í™”ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. `;
                text += "ì´ëŸ¬í•œ ì ì„ ê°€ì •ì—ì„œë„ ë§ì´ ì¹­ì°¬í•´ ì£¼ì‹œë©´ ì•„ì´ê°€ ë” í° ìì‹ ê°ì„ ê°€ì§ˆ ê²ƒì…ë‹ˆë‹¤.\n\n";
            }

            // 5. Closing
            if(tone === 'polite') text += "ì•ìœ¼ë¡œë„ ê¼¼ê¼¼í•˜ê²Œ ì§€ë„í•˜ê² ìŠµë‹ˆë‹¤. ê°€ì •ì—ì„œë„ ë”°ëœ»í•œ ê²©ë ¤ ë¶€íƒë“œë¦½ë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.";
            else if(tone === 'friendly') text += "ì €ë„ ì˜†ì—ì„œ ì—´ì‹¬íˆ ë•ê² ìŠµë‹ˆë‹¤! ê¶ê¸ˆí•œ ì  ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ì—°ë½ì£¼ì„¸ìš”~ ê°ì‚¬í•©ë‹ˆë‹¤. â™¡";
            else text += "ì§€ì†ì ì¸ ê´€ì‹¬ê³¼ ì§€ë„ ë¶€íƒë“œë¦½ë‹ˆë‹¤.";

            // Render
            document.getElementById('r-content').innerText = text;
            loader.style.display = 'none';
        }, 1500);
    }

    function copyToClipboard() {
        const text = document.getElementById('r-content').innerText;
        navigator.clipboard.writeText(text).then(() => {
            alert('ë¦¬í¬íŠ¸ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });
    }
</script>
</body>
</html>